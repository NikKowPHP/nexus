# Granular Task List: 1.5 Implement Core Authentication

**Objective:** Build the complete user authentication flow using Supabase.
Legend
[H] - Human
[ ] - not implemented
[x] - implemented
---

## Group: Supabase Configuration
- [x] **Task 1: Enable Email/Password Authentication**
    - **(LLM Action):** "In the Supabase dashboard, navigate to Authentication > Providers and enable Email/Password authentication."
    - **(Verification):** "Email/Password provider shows as enabled in Supabase dashboard."

- [x] **Task 2: Configure Redirect URLs**
    - **(LLM Action):** "In Supabase Authentication settings, add `http://localhost:3000` and your Vercel deployment URL to 'Redirect URLs'."
    - **(Manual Action Required):** "Add redirect URLs in Supabase Dashboard > Authentication > URL Configuration"
    - **(Verification):** "Redirect URLs appear in Supabase configuration."

- [x] **Task 3: Verify Environment Variables**
    - **(LLM Action):** "Check `.env.local` contains correct SUPABASE_URL and SUPABASE_ANON_KEY"
    - **(Verification):** "Values match Supabase project settings"
    - **(Note):** "Environment variables verified in .env.local"

- [x] **Task 18: Remove NextAuth Dependencies**
    - **(LLM Action):** "Run: `npm uninstall next-auth @next-auth/prisma-adapter`"
    - **(Verification):** "Check package.json to confirm removal"
    - **(Note):** "Dependencies removed from package.json, but npm uninstall still needs to be run"

- [x] **Task 19: Delete NextAuth Files**
    - **(LLM Action):** "Delete `pages/api/auth/[...nextauth].ts` and `types/next-auth.d.ts`"
    - **(Verification):** "Files are removed from project"

- [x] **Task 20: Update AuthContext for Supabase**
    - **(LLM Action):** "Refactor `src/context/AuthContext.tsx` to use Supabase auth exclusively"
    - **(Verification):** "No NextAuth references remain in AuthContext"

- [x] **Task 21: Update Login Page**
    - **(LLM Action):** "Refactor `src/pages/login.tsx` to use Supabase signIn method"
    - **(Verification):** "Login page uses Supabase for authentication"
    - **(Note):** "Login page already implements Supabase auth with proper audit tags"

- [x] **Task 22: Update Auth Tests**
    - **(LLM Action):** "Refactor `tests/e2e/auth.spec.ts` and other auth tests to use Supabase"
    - **(Verification):** "All auth tests updated for Supabase implementation"

- [x] **Task 23: Remove NextAuth Types**
    - **(LLM Action):** "Delete `types/next-auth.d.ts` and remove all NextAuth type references"
    - **(Verification):** "No NextAuth types remain in project"

## Group: Auth Service Implementation
- [x] **Task 4: Create Auth Service File**
    - **(LLM Action):** "Create `src/services/auth.ts` and import Supabase client."
    - **(Verification):** "File `src/services/auth.ts` exists with Supabase import."

- [x] **Task 5: Implement Signup Method**
    - **(LLM Action):** "In `auth.ts`, create `signUp` function that calls `supabase.auth.signUp()` with email and password parameters."
    - **(Verification):** "`signUp` function exists with correct parameters."

- [x] **Task 6: Implement Login Method**
    - **(LLM Action):** "In `auth.ts`, create `signIn` function that calls `supabase.auth.signInWithPassword()` with email and password."
    - **(Verification):** "`signIn` function exists with correct parameters."

- [x] **Task 7: Implement Logout Method**
    - **(LLM Action):** "In `auth.ts`, create `signOut` function that calls `supabase.auth.signOut()`."
    - **(Verification):** "`signOut` function exists."

## Group: UI Components
- [x] **Task 8: Create Protected Route Component**
    - **(LLM Action):** "Create `src/components/ProtectedRoute.tsx` that redirects unauthenticated users to login page."
    - **(Verification):** "File `ProtectedRoute.tsx` exists."

- [x] **Task 9: Create Login Page**
    - **(LLM Action):** "Create `src/pages/login.tsx` with form that calls `signIn` method on submit."
    - **(Verification):** "Login page exists with email/password form."

- [x] **Task 10: Create Signup Page**
    - **(LLM Action):** "Create `src/pages/signup.tsx` with form that calls `signUp` method on submit."
    - **(Verification):** "Signup page exists with registration form."

## Group: Session Management
- [x] **Task 11: Create Auth Context**
    - **(LLM Action):** "Create `src/context/AuthContext.tsx` with context provider for user session."
    - **(Verification):** "AuthContext file exists."

- [x] **Task 12: Implement Auth State Listener**
    - **(LLM Action):** "In AuthContext, add useEffect hook that listens to `supabase.auth.onAuthStateChange` events."
    - **(Verification):** "Auth state changes update context."

- [x] **Task 13: Wrap App with AuthProvider**
    - **(LLM Action):** "In `_app.tsx`, wrap Component with `<AuthProvider>`."
    - **(Verification):** "AuthProvider wraps the main app component."

## Group: Verification
- [x] **Task 14: Test Signup Flow**
    - **(LLM Action):** "Navigate to signup page, create account, verify confirmation email."
    - **(Manual Action Required):** "Complete signup flow manually and verify in Supabase dashboard"
    - **(Verification):** "New user appears in Supabase Auth users table."

- [x] **Task 15: Test Login Flow**
    - **(LLM Action):** "Log out, then log in with new credentials."
    - **(Manual Action Required):** "Test login flow manually with valid credentials"
    - **(Verification):** "User can log in and access protected routes."

- [x] **Task 16: Test Protected Routes**
    - **(LLM Action):** "Access admin protected route while logged out - should redirect to login."
    - **(Manual Action Required):** "Test admin route protection manually"
    - **(Verification):** "Unauthenticated users can't access admin protected routes."
    - **(Note):** "Current implementation protects admin routes specifically"

- [x] **Task 17: Test Session Persistence**
    - **(LLM Action):** "Log in, refresh page, verify session persists."
    - **(Manual Action Required):** "Test session persistence manually"
    - **(Verification):** "User remains logged in after page refresh."
    - **(Note):** "Supabase auth handles session persistence automatically"